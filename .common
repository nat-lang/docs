use ../core/online as online

let output = [];
let doc = x => GuideTexDoc(x, online.window.center);

let prefix typeset = output.push . doc;
let prefix codeblock = output.push . Codeblock;

let prefix print = x => {
  if (vmType(x) == OInstance) {
    if (callable(x.tex))
      output.push(x.tex());
    else if (callable(x.print)
      x.print();
  } else {
    __print__(x);
  }
};

let anchor = (title, tex) => {
  output.push(
    Anchor(
      title,
      online.path,
      doc("\href{#{online.host}#{online.path}##{title}}{#{tex}}")
    )
  );
};

let main = () => Generator(output, serialize);